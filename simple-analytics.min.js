class SimpleAnalytics{constructor(){this.sessionId=this.generateSessionId();this.startTime=Date.now();this.events=[];this.apiEndpoint='/api/analytics';this.trackPageView();this.setupEventListeners();}generateSessionId(){return 'sess_'+Date.now()+'_'+Math.random().toString(36).substr(2,9);}trackPageView(){const pageData={type:'pageview',path:window.location.pathname,referrer:document.referrer?new URL(document.referrer).hostname:'direct',screenSize:`${window.screen.width}x${window.screen.height}`,timestamp:new Date().toISOString(),sessionId:this.sessionId};this.sendEvent(pageData);}trackPromptCopy(promptName,category){const eventData={type:'prompt_copy',promptName:promptName,category:category,path:window.location.pathname,timestamp:new Date().toISOString(),sessionId:this.sessionId};this.sendEvent(eventData);}trackCategoryView(categoryName){const eventData={type:'category_view',category:categoryName,path:window.location.pathname,timestamp:new Date().toISOString(),sessionId:this.sessionId};this.sendEvent(eventData);}trackSearch(hasResults){const eventData={type:'search',hasResults:hasResults,path:window.location.pathname,timestamp:new Date().toISOString(),sessionId:this.sessionId};this.sendEvent(eventData);}trackAffiliateClick(productType,location){const eventData={type:'affiliate_click',productType:productType,location:location,path:window.location.pathname,timestamp:new Date().toISOString(),sessionId:this.sessionId};this.sendEvent(eventData);}trackTimeOnPage(){const timeSpent=Math.round((Date.now()-this.startTime)/1000);const eventData={type:'time_on_page',duration:timeSpent,path:window.location.pathname,timestamp:new Date().toISOString(),sessionId:this.sessionId};if(navigator.sendBeacon){const blob=new Blob([JSON.stringify(eventData)],{type:'application/json'});navigator.sendBeacon(this.apiEndpoint,blob);}else{this.sendEvent(eventData);}}async sendEvent(eventData){try{if(this.apiEndpoint&&window.location.hostname!=='localhost'){await fetch(this.apiEndpoint,{method:'POST',headers:{'Content-Type':'application/json',},body:JSON.stringify(eventData)}).catch(()=>{this.storeLocally(eventData);});}else{this.storeLocally(eventData);}}catch(error){this.storeLocally(eventData);}}storeLocally(eventData){const storageKey='simple_analytics_'+new Date().toISOString().split('T')[0];const existing=localStorage.getItem(storageKey);const events=existing?JSON.parse(existing):[];events.push(eventData);if(events.length>1000){events.shift();}localStorage.setItem(storageKey,JSON.stringify(events));if(window.location.hostname==='localhost'||window.location.hostname==='127.0.0.1'){console.log('Analytics Event:',eventData);}}setupEventListeners(){window.addEventListener('beforeunload',()=>this.trackTimeOnPage());document.querySelectorAll('.category-card').forEach(card=>{card.addEventListener('click',()=>{const categoryName=card.querySelector('h3')?.textContent;if(categoryName){this.trackCategoryView(categoryName);}});});document.querySelectorAll('a[href*="clickbank"],a[href*="affiliate"]').forEach(link=>{link.addEventListener('click',()=>{const location=link.closest('.affiliate-section')?'affiliate-section':link.closest('.hero')?'hero':'inline';const productType=link.closest('.affiliate-section')?'recommended':'contextual';this.trackAffiliateClick(productType,location);});});}static getStoredAnalytics(){const analytics={};const keys=Object.keys(localStorage).filter(k=>k.startsWith('simple_analytics_'));keys.forEach(key=>{const date=key.replace('simple_analytics_','');analytics[date]=JSON.parse(localStorage.getItem(key)||'[]');});return analytics;}static generateStats(){const analytics=SimpleAnalytics.getStoredAnalytics();const stats={totalPageViews:0,totalPromptCopies:0,totalAffiliateClicks:0,topPages:{},topPrompts:{},dailyStats:{}};Object.entries(analytics).forEach(([date,events])=>{stats.dailyStats[date]={pageViews:0,promptCopies:0,affiliateClicks:0};events.forEach(event=>{if(event.type==='pageview'){stats.totalPageViews++;stats.dailyStats[date].pageViews++;stats.topPages[event.path]=(stats.topPages[event.path]||0)+1;}else if(event.type==='prompt_copy'){stats.totalPromptCopies++;stats.dailyStats[date].promptCopies++;stats.topPrompts[event.promptName]=(stats.topPrompts[event.promptName]||0)+1;}else if(event.type==='affiliate_click'){stats.totalAffiliateClicks++;stats.dailyStats[date].affiliateClicks++;}});});return stats;}}let analytics;document.addEventListener('DOMContentLoaded',()=>{analytics=new SimpleAnalytics();window.simpleAnalytics=analytics;});if(typeof module!=='undefined'&&module.exports){module.exports=SimpleAnalytics;}
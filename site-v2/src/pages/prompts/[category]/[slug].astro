---
import Base from "../../../layouts/Base.astro";
import Header from "../../../components/Header.astro";
import Footer from "../../../components/Footer.astro";
import fs from 'node:fs';
import path from 'node:path';

export async function getStaticPaths() {
  const root = path.join(import.meta.dirname, '../../../data/prompts');
  const paths = [];
  if (!fs.existsSync(root)) return [];
  const cats = fs.readdirSync(root, { withFileTypes: true }).filter(d => d.isDirectory()).map(d => d.name);
  for (const c of cats) {
    const dir = path.join(root, c);
    const files = fs.readdirSync(dir).filter(f => f.endsWith('.json'));
    for (const f of files) {
      const d = JSON.parse(fs.readFileSync(path.join(dir, f), 'utf8'));
      paths.push({ params: { category: c, slug: d.slug } });
    }
  }
  return paths;
}

const { category, slug } = Astro.params;
const file = path.join(import.meta.dirname, '../../../data/prompts', category!, `${slug}.json`);
const data = JSON.parse(fs.readFileSync(file, 'utf8'));

const title = `${data.title} â€” FreePromptHub`;
const description = data.description || '';
---
<Base {title} {description} canonical={`https://www.freeprompthub.com/prompts/${category}/${slug}`}>
  <Header />
  <main class="container py-10">
    <article class="prose dark:prose-invert max-w-none">
      <h1>{data.title}</h1>
      <p class="text-gray-600 dark:text-gray-300">{data.description}</p>
      <h2>Prompt</h2>
      <pre class="card whitespace-pre-wrap">{data.prompt}</pre>
      {data.tips && (
        <>
          <h3>Tips</h3>
          <ul>
            {data.tips.map((t: string) => <li>{t}</li>)}
          </ul>
        </>
      )}
      {data.tags?.length && (
        <p><strong>Tags:</strong> {data.tags.join(', ')}</p>
      )}
    </article>
  </main>
  <Footer />
</Base>

